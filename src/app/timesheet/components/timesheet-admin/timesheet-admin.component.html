<div class="container">
  <h2>Timesheet Admin</h2>

  <!-- Project creation -->
  <section class="create-project">
    <h4>Create Project</h4>
    <label>
      Name:
      <input [(ngModel)]="newProject.name" placeholder="Project name" />
    </label>
    <label>
      Description:
      <input [(ngModel)]="newProject.description" placeholder="Optional description" />
    </label>
    <button (click)="createProject()" [disabled]="!newProject.name.trim()">Create Project</button>
    <div class="small" *ngIf="projectCreatedMsg">{{ projectCreatedMsg }}</div>
  </section>

  <hr />

  <!-- Entry creation -->
  <section class="create-entry">
    <h4>Create Timesheet Entry</h4>
    <label>
      Project:
      <select [(ngModel)]="newEntry.project">
        <option value="">-- Select project --</option>
        <option *ngFor="let p of svc.projects" [value]="p.name">{{ p.name }}</option>
      </select>
    </label>

    <label>
      User:
      <input [(ngModel)]="newEntry.user" placeholder="User name" />
    </label>

    <label>
      Date:
      <input type="date" [(ngModel)]="newEntry.date" />
    </label>

    <label>
      Units:
      <input type="number" min="1" [(ngModel)]="newEntry.unit" />
    </label>

    <label>
      Activity:
      <input [(ngModel)]="newEntry.activity" placeholder="Activity (e.g. Development)" />
    </label>

    <label>
      Comment:
      <input [(ngModel)]="newEntry.comment" placeholder="Optional comment" />
    </label>

    <div class="entry-actions">
      <button (click)="createEntry()" [disabled]="!canCreateEntry()">Add Entry</button>
      <button (click)="resetEntryForm()">Reset</button>
    </div>

    <div class="small" *ngIf="entryCreatedMsg">{{ entryCreatedMsg }}</div>
  </section>

  <hr />

  <!-- Filters & bulk actions -->
  <div class="controls">
    <label>Filter by project:
      <select [(ngModel)]="filters.project">
        <option value="">-- All projects --</option>
        <option *ngFor="let p of svc.projects" [value]="p.name">{{p.name}}</option>
      </select>
    </label>

    <label>Filter by status:
      <select [(ngModel)]="filters.status">
        <option value="">-- All statuses --</option>
        <option value="PENDING">Pending</option>
        <option value="APPROVED">Approved</option>
        <option value="REJECTED">Rejected</option>
      </select>
    </label>

    <button (click)="selectAllVisible()">Select Visible</button>
    <button (click)="clearSelection()">Clear Selection</button>

    <div class="bulk-actions">
      <button (click)="prepareBulk('APPROVED')" [disabled]="!hasSelected()">Approve Selected</button>
      <button (click)="prepareBulk('REJECTED')" [disabled]="!hasSelected()">Reject Selected</button>
    </div>
  </div>

  <!-- Timesheet table -->
  <table class="timesheet-table">
    <thead>
      <tr>
        <th><input type="checkbox" [checked]="allVisibleSelected()" (change)="toggleSelectAll($event)" /></th>
        <th>Date</th>
        <th>User</th>
        <th>Comment</th>
        <th>Created Date</th>
        <th>Unit</th>
        <th>Project</th>
        <th>Activity</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let e of filteredEntries(); let i = index" [class.selected]="isSelected(e.id)">
        <td><input type="checkbox" [checked]="isSelected(e.id)" (change)="onToggleSelect(e.id, $event)" /></td>
        <td>{{ e.date | date:'mediumDate' }}</td>
        <td>{{ e.user }}</td>
        <td class="comment">{{ e.comment || '-' }}</td>
        <td>{{ e.createdDate | date:'short' }}</td>
        <td>{{ e.unit }}</td>
        <td>{{ e.project }}</td>
        <td>{{ e.activity }}</td>
        <td><span class="status" [ngClass]="e.status">{{ e.status }}</span></td>
        <td class="row-actions">
          <button (click)="prepareSingle(e, 'APPROVED')" [disabled]="e.status === 'APPROVED'">Approve</button>
          <button (click)="prepareSingle(e, 'REJECTED')" [disabled]="e.status === 'REJECTED'">Reject</button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Footer -->
  <div class="footer">
    <div>Selected: {{ selectedCount() }}</div>
    <button (click)="openSaveModal()" [disabled]="!hasPendingChanges()">Save Changes</button>
  </div>

  <app-timesheet-save-modal *ngIf="modalOpen"
    [changes]="modalChanges"
    (onConfirm)="commitModal($event)"
    (onCancel)="closeModal()"></app-timesheet-save-modal>

  <div class="toast" *ngIf="toast.show">{{ toast.message }}</div>
</div>
